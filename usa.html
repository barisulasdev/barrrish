<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Presidential election turnout by state</title>
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <style>
    html, body {
      margin: 0em 0em 5em 0em;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    #chart {
      width: 100%;
      height: 100%;
    }

    h2.title {
      text-align: center;
      font-size: 20px;
      margin: 0.5em 0;
    }

    svg {
      display: block;
      width: 100%;
      height: 100%;
    }

    .axis text {
      font-size: 10px;
    }

    .row {
      cursor: pointer;
    }
  </style>
</head>
<body>

<h2 class="title">Presidential Election Participation by State (1948â€“2020)</h2>
<div id="chart"></div>

<script>
// US states
const states = [
  "Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "Florida", "Georgia",
  "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland",
  "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey",
  "New Mexico", "New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina",
  "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming", "D.C."
];

const years = d3.range(1948, 2021, 4);

// Base turnout trend
const baseTurnout = {
  1948: 51.0, 1952: 63.3, 1956: 60.0, 1960: 62.8, 1964: 61.9,
  1968: 60.8, 1972: 55.2, 1976: 53.6, 1980: 52.6, 1984: 53.3,
  1988: 50.3, 1992: 55.2, 1996: 49.0, 2000: 51.2, 2004: 56.7,
  2008: 58.2, 2012: 54.9, 2016: 60.1, 2020: 66.8
};

// Generate data per state
function generateStateTurnout(base) {
  return states.map(state => {
    return years.map(year => {
      const baseRate = base[year];
      const bias = (
        state === "Minnesota" ? +6 :
        state === "Hawaii" ? -7 :
        state === "D.C." ? +5 :
        state === "Texas" ? -5 :
        state === "Wisconsin" ? +3 :
        state === "West Virginia" ? -4 :
        0
      );
      const noise = Math.random() * 16 - 8;
      const turnout = Math.max(35, Math.min(80, baseRate + bias + noise));
      return Math.round(turnout * 10) / 10;
    });
  });
}

const values = generateStateTurnout(baseTurnout);

const margin = {top: 30, right: 10, bottom: 40, left: 120};
const rowHeight = 14;
const width = window.innerWidth;
const height = window.innerHeight;

const svg = d3.select("#chart").append("svg")
  .attr("width", width)
  .attr("height", height);

// Scales
const x = d3.scaleBand()
  .domain(years)
  .range([margin.left, width - margin.right])
  .padding(0.05);

const y = d3.scaleBand()
  .domain(states)
  .range([margin.top, height - margin.bottom])
  .padding(0.1);

const color = d3.scaleSequential()
  .domain([35, 80])
  .interpolator(d3.interpolateViridis);

const grayColor = d3.scaleLinear()
  .domain([35, 80])
  .range(["#ddd", "#888"]);

// Axes
svg.append("g")
  .attr("transform", `translate(0, ${margin.top})`)
  .call(d3.axisTop(x).tickFormat(d3.format("d")))
  .call(g => g.select(".domain").remove());

svg.append("g")
  .attr("transform", `translate(${margin.left},0)`)
  .call(d3.axisLeft(y).tickSize(0))
  .call(g => g.select(".domain").remove());

// Draw rows
const rowGroups = svg.selectAll(".row")
  .data(values)
  .join("g")
    .attr("class", "row")
    .attr("data-state", (d, i) => states[i])
    .attr("transform", (d, i) => `translate(0, ${y(states[i])})`)
    .on("mouseover", function(event, d) {
      const selectedState = d3.select(this).attr("data-state");

      svg.selectAll(".row")
        .classed("faded", true)
        .selectAll("rect")
        .transition().duration(150)
        .attr("fill", (d, i) => grayColor(d));

      d3.select(this)
        .classed("faded", false)
        .selectAll("rect")
        .transition().duration(150)
        .attr("fill", (d, i) => color(d));
    })
    .on("mouseout", function() {
      svg.selectAll(".row")
        .classed("faded", false)
        .selectAll("rect")
        .transition().duration(150)
        .attr("fill", (d, i) => color(d));
    });

rowGroups.selectAll("rect")
  .data(d => d)
  .join("rect")
    .attr("x", (d, i) => x(years[i]))
    .attr("width", x.bandwidth())
    .attr("height", y.bandwidth() - 1)
    .attr("fill", d => color(d))
    .append("title")
    .text((d, i) => `${years[i]}: ${d}%`);
</script>

</body>
</html>
